<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üö® IMMEDIATE NETLIFY FIX VERIFICATION</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            line-height: 1.6;
        }
        .alert {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .alert-danger {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }
        .alert-success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        .alert-warning {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin: 10px 5px;
            display: inline-block;
            text-decoration: none;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .test-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        h1 {
            color: #dc3545;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-error {
            background: #dc3545;
        }
        .status-success {
            background: #28a745;
        }
        .status-warning {
            background: #ffc107;
        }
    </style>
</head>
<body>
    <h1>üö® NETLIFY FOOTBALL DATA FIX VERIFICATION</h1>
    
    <div class="alert alert-danger">
        <strong>‚ö†Ô∏è ISSUE DETECTED:</strong> Your debug report shows the old broken version is still deployed!<br>
        Your site is calling <code>fetch-football-api</code> instead of <code>fetch-football</code>.
    </div>

    <h2>üîç Step 1: Verify Current Status</h2>
    <p>Let's check what's actually deployed right now:</p>
    
    <button class="btn btn-danger" onclick="checkDeployedVersion()">üîç Check Deployed Version</button>
    <button class="btn" onclick="testBothFunctions()">üß™ Test Both Functions</button>
    
    <div id="version-check" class="test-result" style="display: none;"></div>

    <h2>üìù Step 2: Deployment Checklist</h2>
    <div class="alert alert-warning">
        <strong>Did you complete ALL these steps?</strong>
        <ol>
            <li>‚úÖ Save the changes to <code>web-matchfetcher.js</code></li>
            <li>‚úÖ Commit: <code>git add . && git commit -m "Fix football function"</code></li>
            <li>‚úÖ Push: <code>git push</code></li>
            <li>‚úÖ Wait for Netlify auto-deploy (check dashboard)</li>
            <li>‚úÖ Clear browser cache (Ctrl+Shift+R)</li>
        </ol>
    </div>

    <h2>üöÄ Step 3: Immediate Force Deployment</h2>
    <p>If you're not sure about the deployment, here's what to do:</p>
    
    <div class="code-block">
# Navigate to your project folder
cd C:\svn\git\SportsApp

# Check git status
git status

# If changes are not committed:
git add .
git commit -m "Fix Netlify football data fetching"

# Push to trigger deployment
git push origin main

# Or if you use master branch:
git push origin master
    </div>

    <h2>‚ö° Step 4: Manual Cache Clear</h2>
    <p>After deployment, clear all caches:</p>
    
    <button class="btn btn-success" onclick="clearAllCaches()">üßπ Clear All Caches</button>
    <button class="btn" onclick="forceReload()">üîÑ Force Reload Page</button>

    <h2>üß™ Step 5: Test Working Function Directly</h2>
    <p>Let's test if the working function exists:</p>
    
    <button class="btn btn-success" onclick="testWorkingFunction()">‚úÖ Test fetch-football (Should Work)</button>
    <button class="btn btn-danger" onclick="testBrokenFunction()">‚ùå Test fetch-football-api (Broken)</button>
    
    <div id="function-test" class="test-result" style="display: none;"></div>

    <h2>üîß Step 6: Emergency Manual Fix</h2>
    <p>If deployment is taking too long, you can manually patch the live site:</p>
    
    <button class="btn btn-warning" onclick="showManualFix()">üö® Show Emergency Fix</button>
    
    <div id="manual-fix" style="display: none;">
        <div class="alert alert-warning">
            <strong>üö® EMERGENCY BROWSER CONSOLE FIX:</strong>
            <p>Open browser console (F12) on your main site and paste this:</p>
            <div class="code-block" id="emergency-code">
// Emergency fix - change the URL in browser memory
if (window.sportsApp && window.sportsApp.matchFetcher) {
    console.log('üîß Applying emergency fix...');
    window.sportsApp.matchFetcher.netlifyFunctionUrl = '/.netlify/functions/fetch-football';
    console.log('‚úÖ Emergency fix applied! Try refreshing data now.');
    
    // Test the fix
    window.sportsApp.fetchNewSportsData().then(result => {
        console.log('üß™ Test result:', result);
        if (result.success) {
            console.log('‚úÖ Emergency fix working!');
        } else {
            console.log('‚ùå Still issues:', result.error);
        }
    });
} else {
    console.log('‚ùå Sports app not found');
}
            </div>
        </div>
    </div>

    <h2>üìä Current Site Analysis</h2>
    <div id="site-analysis">
        <p><span class="status-indicator status-error"></span><strong>Football Function:</strong> Using broken API function</p>
        <p><span class="status-indicator status-success"></span><strong>UFC Function:</strong> Working correctly (10 events found)</p>
        <p><span class="status-indicator status-error"></span><strong>Football Matches:</strong> 0 found (should have some)</p>
        <p><span class="status-indicator status-warning"></span><strong>Deployment Status:</strong> Old version still live</p>
    </div>

    <h2>‚úÖ Expected After Fix</h2>
    <div class="alert alert-success">
        <strong>When the fix is properly deployed, you should see:</strong>
        <ul>
            <li>‚úÖ <code>fetch-football</code> being called instead of <code>fetch-football-api</code></li>
            <li>‚úÖ Source: <code>live-data</code> instead of <code>openligadb</code></li>
            <li>‚úÖ Multiple football matches appearing</li>
            <li>‚úÖ TV channels being extracted and listed</li>
        </ul>
    </div>

    <div class="alert alert-warning">
        <strong>üïê Deployment typically takes 1-3 minutes after pushing to git.</strong><br>
        Check your Netlify dashboard to see deployment status.
    </div>

    <script>
        async function checkDeployedVersion() {
            const resultDiv = document.getElementById('version-check');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-info';
            resultDiv.textContent = 'Checking deployed files...';
            
            try {
                // Check if we can access the main app and see what function it's configured to use
                const response = await fetch('/web-matchfetcher.js?v=' + Date.now(), {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    const content = await response.text();
                    
                    let analysis = 'DEPLOYED VERSION ANALYSIS:\n\n';
                    
                    // Check if it contains the fix
                    if (content.includes('fetch-football-api')) {
                        analysis += '‚ùå PROBLEM: Still contains fetch-football-api\n';
                    }
                    
                    if (content.includes("'/.netlify/functions/fetch-football'")) {
                        analysis += '‚úÖ GOOD: Contains fixed fetch-football URL\n';
                    } else {
                        analysis += '‚ùå PROBLEM: Does not contain fixed fetch-football URL\n';
                    }
                    
                    if (content.includes('callNetlifyFunction')) {
                        analysis += '‚úÖ GOOD: Contains new function calling method\n';
                    } else {
                        analysis += '‚ùå PROBLEM: Missing new function calling method\n';
                    }
                    
                    analysis += '\nFile size: ' + content.length + ' characters\n';
                    analysis += 'Last modified: ' + response.headers.get('last-modified') + '\n';
                    
                    if (content.includes('fetch-football-api') && !content.includes("'/.netlify/functions/fetch-football'")) {
                        analysis += '\nüö® CONCLUSION: OLD VERSION STILL DEPLOYED!\n';
                        analysis += 'You need to commit and push your changes.';
                        resultDiv.className = 'test-result result-error';
                    } else if (content.includes("'/.netlify/functions/fetch-football'")) {
                        analysis += '\n‚úÖ CONCLUSION: NEW VERSION IS DEPLOYED!\n';
                        analysis += 'The fix should be working. Try clearing cache and reload.';
                        resultDiv.className = 'test-result result-success';
                    } else {
                        analysis += '\n‚ö†Ô∏è CONCLUSION: UNCLEAR VERSION STATUS\n';
                        analysis += 'File content is unexpected. Check deployment.';
                        resultDiv.className = 'test-result result-warning';
                    }
                    
                    resultDiv.textContent = analysis;
                    
                } else {
                    resultDiv.className = 'test-result result-error';
                    resultDiv.textContent = `Cannot access deployed files: ${response.status} ${response.statusText}`;
                }
                
            } catch (error) {
                resultDiv.className = 'test-result result-error';
                resultDiv.textContent = `Error checking deployment: ${error.message}`;
            }
        }
        
        async function testBothFunctions() {
            const resultDiv = document.getElementById('version-check');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-info';
            resultDiv.textContent = 'Testing both functions...';
            
            let results = 'FUNCTION COMPARISON TEST:\n\n';
            
            // Test the working function
            try {
                const workingResponse = await fetch('/.netlify/functions/fetch-football', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                results += '‚úÖ fetch-football (SHOULD WORK):\n';
                results += `   Status: ${workingResponse.status} ${workingResponse.statusText}\n`;
                
                if (workingResponse.ok) {
                    const data = await workingResponse.json();
                    results += `   Success: ${data.success}\n`;
                    results += `   Matches: ${data.matches ? data.matches.length : 0}\n`;
                    results += `   Source: ${data.source || 'unknown'}\n`;
                    results += `   Note: ${data.note || 'none'}\n`;
                } else {
                    const errorText = await workingResponse.text();
                    results += `   Error: ${errorText.substring(0, 100)}...\n`;
                }
                
            } catch (error) {
                results += `‚ùå fetch-football FAILED: ${error.message}\n`;
            }
            
            results += '\n';
            
            // Test the broken function
            try {
                const brokenResponse = await fetch('/.netlify/functions/fetch-football-api', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                results += '‚ùå fetch-football-api (BROKEN - needs API keys):\n';
                results += `   Status: ${brokenResponse.status} ${brokenResponse.statusText}\n`;
                
                if (brokenResponse.ok) {
                    const data = await brokenResponse.json();
                    results += `   Success: ${data.success}\n`;
                    results += `   Matches: ${data.matches ? data.matches.length : 0}\n`;
                    results += `   Source: ${data.source || 'unknown'}\n`;
                    results += `   Note: ${data.note || 'none'}\n`;
                } else {
                    const errorText = await brokenResponse.text();
                    results += `   Error: ${errorText.substring(0, 100)}...\n`;
                }
                
            } catch (error) {
                results += `‚ùå fetch-football-api FAILED: ${error.message}\n`;
            }
            
            results += '\nüéØ YOUR APP SHOULD USE: fetch-football (the working one)';
            results += '\nüö® YOUR APP IS USING: fetch-football-api (the broken one)';
            
            resultDiv.className = 'test-result result-warning';
            resultDiv.textContent = results;
        }
        
        async function testWorkingFunction() {
            const resultDiv = document.getElementById('function-test');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-info';
            resultDiv.textContent = 'Testing the working function...';
            
            try {
                const response = await fetch('/.netlify/functions/fetch-football', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                let result = `TESTING: /.netlify/functions/fetch-football\n\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `OK: ${response.ok}\n\n`;
                
                if (response.ok) {
                    const data = await response.json();
                    result += `SUCCESS: ${data.success}\n`;
                    result += `SOURCE: ${data.source || 'unknown'}\n`;
                    result += `MATCHES: ${data.matches ? data.matches.length : 0}\n`;
                    result += `TODAY: ${data.todayCount || 0}\n`;
                    result += `TOTAL: ${data.totalFound || 0}\n`;
                    result += `NOTE: ${data.note || 'none'}\n`;
                    
                    if (data.matches && data.matches.length > 0) {
                        result += `\nSAMPLE MATCH:\n`;
                        const sample = data.matches[0];
                        result += `  ${sample.time} - ${sample.teamA} vs ${sample.teamB}\n`;
                        result += `  ${sample.competition} on ${sample.channel}\n`;
                        
                        resultDiv.className = 'test-result result-success';
                        result += `\n‚úÖ THIS FUNCTION WORKS! Your app should use this one.`;
                    } else {
                        resultDiv.className = 'test-result result-warning';
                        result += `\n‚ö†Ô∏è Function works but found no matches for today.`;
                    }
                } else {
                    const errorText = await response.text();
                    result += `ERROR: ${errorText}`;
                    resultDiv.className = 'test-result result-error';
                }
                
                resultDiv.textContent = result;
                
            } catch (error) {
                resultDiv.className = 'test-result result-error';
                resultDiv.textContent = `Request failed: ${error.message}\n\nThis suggests the function doesn't exist or there's a network issue.`;
            }
        }
        
        async function testBrokenFunction() {
            const resultDiv = document.getElementById('function-test');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result result-info';
            resultDiv.textContent = 'Testing the broken function (your app is currently using this one)...';
            
            try {
                const response = await fetch('/.netlify/functions/fetch-football-api', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                let result = `TESTING: /.netlify/functions/fetch-football-api\n\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `OK: ${response.ok}\n\n`;
                
                if (response.ok) {
                    const data = await response.json();
                    result += `SUCCESS: ${data.success}\n`;
                    result += `SOURCE: ${data.source || 'unknown'}\n`;
                    result += `MATCHES: ${data.matches ? data.matches.length : 0}\n`;
                    result += `NOTE: ${data.note || 'none'}\n`;
                    
                    if (data.source === 'openligadb') {
                        result += `\n‚ùå PROBLEM: Using German league data only (openligadb)`;
                        result += `\n‚ùå ISSUE: No API keys configured for UK football data`;
                        result += `\nüö® YOUR APP IS USING THIS BROKEN FUNCTION!`;
                    }
                    
                    resultDiv.className = 'test-result result-error';
                } else {
                    const errorText = await response.text();
                    result += `ERROR: ${errorText}`;
                    resultDiv.className = 'test-result result-error';
                }
                
                resultDiv.textContent = result;
                
            } catch (error) {
                resultDiv.className = 'test-result result-error';
                resultDiv.textContent = `Request failed: ${error.message}`;
            }
        }
        
        function clearAllCaches() {
            // Clear various caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // Clear localStorage
            if (typeof(Storage) !== "undefined") {
                localStorage.clear();
                sessionStorage.clear();
            }
            
            alert('‚úÖ Caches cleared! Now reload the page with Ctrl+Shift+R');
        }
        
        function forceReload() {
            // Force reload with cache bypass
            window.location.reload(true);
        }
        
        function showManualFix() {
            const manualDiv = document.getElementById('manual-fix');
            manualDiv.style.display = manualDiv.style.display === 'none' ? 'block' : 'none';
        }
        
        // Auto-run deployment check on page load
        window.addEventListener('load', () => {
            console.log('üîß Netlify Fix Verification Page Loaded');
            console.log('üí° Click "Check Deployed Version" to see if your changes were deployed');
            
            // Auto-check after a delay
            setTimeout(() => {
                console.log('üîç Auto-checking deployed version...');
                checkDeployedVersion();
            }, 2000);
        });
    </script>
</body>
</html>
